<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>QR Code掃描速率測試</title>
    <style>
        table {
            border-collapse: collapse;
            width: 80%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>QR Code掃描速率測試</h1>
    <p>請掃描列印的QR Code以測試回傳速率</p>
    <h2>掃描記錄</h2>
    <table>
        <thead>
            <tr>
                <th>生成時間</th>
                <th>掃描時間</th>
                <th>耗時 (秒)</th>
            </tr>
        </thead>
        <tbody id="historyTable"></tbody>
    </table>

    <script>
        // 從本地儲存中加載歷史記錄
        let scanHistory = JSON.parse(localStorage.getItem('scanHistory')) || [];

        // 格式化時間戳為日期和時間（含毫秒）
        function formatTimestamp(ms) {
            const date = new Date(ms);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const milliseconds = String(date.getMilliseconds()).padStart(3, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;
        }

        // 從URL獲取生成時間戳
        const urlParams = new URLSearchParams(window.location.search);
        const startTime = parseInt(urlParams.get('timestamp')) || Date.now();
        const endTime = Date.now();

        // 計算耗時（秒，保留三位小數）
        const timeDifferenceSeconds = ((endTime - startTime) / 1000).toFixed(3);

        // 格式化時間
        const startTimeFormatted = formatTimestamp(startTime);
        const endTimeFormatted = formatTimestamp(endTime);

        // 添加到歷史記錄
        const scanData = { startTimeFormatted, endTimeFormatted, timeDifferenceSeconds };
        scanHistory.push(scanData);
        localStorage.setItem('scanHistory', JSON.stringify(scanHistory));

        // 更新表格
        const historyTable = document.getElementById('historyTable');
        historyTable.innerHTML = '';
        scanHistory.forEach(data => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.startTimeFormatted}</td>
                <td>${data.endTimeFormatted}</td>
                <td>${data.timeDifferenceSeconds}</td>
            `;
            historyTable.appendChild(row);
        });
    </script>
</body>
</html>
